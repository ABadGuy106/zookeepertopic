# Zookeeper分布式专题与Dubbo微服入门

## 分布式系统概念与zookeeper简介

#### 什么是分布式系统？

- 很多台计算机组成一个整体，一个整体一致对外并且处理同一请求
- 内部的每台计算机都可以相互通信（rest/rpc）
- 客户端到服务端的一次请求到响应结束会经历多台计算机

#### zookeeper的特性

- 一致性：数据一致性，数据按照顺序分批入库
- 原子性：事务要么成功要么失败，不会局部化
- 单一视图：客户端连接集群的任一zk节点，数据都是一致的
- 可靠性：每次对zk的操作状态都会保存在服务端
- 实时性：客户端可以读取到zk服务端的最新数据


#### zookeeper主要目录结构

- bin:主要的一些运行命令
- conf:存放配置文件，其中我们需要修改zk.cfg
- contrib:附加的一些功能
- dist-mavne:mvn编译后的目录
- doc:文档
- lib:依赖jar包
- recipes:案例demo代码
- src:源码

#### zoo.cfg配置

- tickTime:用于计算的时间单元。比如session超时：N*tickTime
- initLimit:用于集群，允许从节点连接并同步到master节点的初始化连接时间，以tickTIme的倍数来表示
- syncLimit:用于集群，master主节点与从节点之间发送消息请求和应答时间长度。（心跳机制）
- dataDir:必须配置
- dataLogDir:日志目录，如果不配置会和dataDir共用同一个目录
- clientPort:连接服务器端口，默认2181

## zookeeper基本数据模型介绍

- 是一个树形结构，类似于前端开发中的tree.js组件
- 每个节点都称之为znode,它可以有子节点，也可以有数据
- 每个节点分为临时节点和永久节点，临时节点在客户端断开后消失
- 每个zk节点都有各自的版本号，可以通过命令行来显示节点信息
- 每当节点数据发生变化，那么该节点的版本号会累加(乐观锁)
- 删除/修改过时节点，版本号不匹配会报错
- 每个zk节点存储的数据不宜过大，几k即可
- 节点可以设置权限acl,可以通过权限来限制用户的访问

#### zk的作用体现

- master节点选举，主节点挂了以后，从节点就会接手主节点的工作，并且保证这个节点是唯一的，这也是所谓首脑模式，从而保证我们的集群高可用的
- 统一配置文件管理，即只需要部署一台服务器，则可以把相同的配置文件同步更新到其他所有的服务器，此操作在云计算中用的特别多（假设修改了redis统一配置）
- 发布与订阅，类似消息队列MQ(amq,rmq...)，dubbo发布者把数据存在znode上，订阅者会读取这个数据
- 提供分布式锁，分布式环境中不同进程之间争夺资源，类似于多线程中的锁
- 集群管理，集群中保证数据的强一致性

## ZK基于特性于基于Linux的ZK客户端命令学习

通过./zkCli.sh 打开zk的客户端进入命令行后台

ls与ls2命令

​	ls2=ls+stat

get与stat命令

#### ACL命令行学习

world:anyone:cdrwa





## 使用zookeeper原生Java API进行客户端开发

- 会话连接与恢复
- 节点的增删改查
- watch与acl的相关操作





















































































































































